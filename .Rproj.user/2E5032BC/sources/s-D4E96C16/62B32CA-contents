---
title: "Cancer_survival_stats"
author: "Serdar Korur"
date: "10/31/2019"
output: html_document
---

Loading in data and setting up

Data source: https://academic.oup.com/jnci/article/109/9/djx030/3092246

```{r set up, warning = FALSE, message = FALSE}

library(extrafont)
library(readxl)
library(tidyverse) # ggplot2, dplyr, tidyr, readr, 
                   # purrr, tibble, stringr, forcat
library(ggdark)


cancer <- read_excel( "cancersurvivalstatistics.xls", sheet = 3)

```

Subset the data

```{r pre-process}
cancer <- na.omit(cancer)[-2, 1:5]
colnames(cancer) <- c("type", "start", "end", "Absolute", "Proportional")
cancer[,2:5] <- sapply(cancer[,2:5], as.numeric)
cancer$type[19] <- "Uterus"
cancer$type[16] <- "Prostate (Men)"
head(cancer)

```

Visualize

# Final Plot
```{r Final}
cancer %>% 
    mutate(type = fct_reorder(type, end)) %>% 
    ggplot() + 
    geom_segment(aes(x=start, xend=end-1, y=type, yend=type), color="#00AFBB", size=1, arrow = arrow(length = unit(0.3,"cm"), type = "closed")) +
    geom_point(aes(x=start, y=type),  color="#E7B800", size=2) + 
    geom_point(aes(x=end, y=type), size=2.5, color = "#FC4E07") + 
    geom_point(aes(x=100, y=5), size = 2, color = "#E7B800") +
    geom_point(aes(x=100, y=4), size =2, color = "#FC4E07") + 
    geom_text(aes(x=93, y=5), color ="#B2B2B2",label ="1975-77") + 
    geom_text(aes(x=93, y=4), color ="#B2B2B2", label ="2006-12") +
    dark_theme_gray() +
    theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"),
          text = element_text(size=16),
          legend.position = "none",
          axis.text.y = element_text(size=16),
          axis.title.y = element_blank(),
          axis.title.x = element_blank(),
          axis.line.y = element_blank(),
          axis.ticks.y = element_blank(),
          plot.caption = element_text(size= 12, hjust = 0, vjust = -10),
          plot.subtitle=element_text(size=12, face="italic")) +
    geom_text(mapping = aes(x = ifelse(cancer$type != c("Uterus", "Cervix Uteri"), start-1, start+1), 
                            y=type, label=start), hjust = ifelse(cancer$type != c("Uterus", "Cervix Uteri"),"right", "left"), vjust=0.28) +
    geom_text(mapping = aes(x = ifelse(cancer$type != c("Uterus", "Cervix Uteri"), end+2, end-1), 
                            y=type, label=end), hjust = ifelse(cancer$type != c("Uterus", "Cervix Uteri"), "left","right"), vjust=0.28) +
    coord_cartesian(xlim = c(0, 110), expand =1) +
    scale_x_continuous(labels = function(x) paste0(x, "%")) + 
    labs( caption= "Data: https://doi.org/10.1093/jnci/djx030, \nVisualization: Serdar Korur",
          title = "Improvement in cancer survival rates in US", 
          subtitle="Five year survival rates of most common cancer types \ncompared between 1975-77 and 2006-2012. All genders & races.")